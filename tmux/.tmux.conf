##############################################################################
# TMUX - ULTIMATE CONFIGURATION
##############################################################################

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# PODSTAWOWE USTAWIENIA
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Zmiana prefiksu na Ctrl+a (bardziej ergonomiczne niż Ctrl+b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Błyskawiczne reakcje - brak opóźnień
set -sg escape-time 0
set -g repeat-time 500

# Zwiększenie limitu historii
set -g history-limit 50000

# Włączenie obsługi myszki (scroll, resize, select)
set -g mouse on

# Numeracja okien i paneli od 1 (bardziej naturalne)
set -g base-index 1
setw -g pane-base-index 1

# Automatyczne przenumerowanie okien po zamknięciu
set -g renumber-windows on

# Włącz focus events (dla vim/neovim)
set -g focus-events on

# Nie zmieniaj automatycznie nazw okien
set -g allow-rename off
set -g automatic-rename off

# Dłuższy czas wyświetlania komunikatów
set -g display-time 2000
set -g display-panes-time 3000

# Agresywne zmiany rozmiaru (lepsze dla wielu klientów)
setw -g aggressive-resize on

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# KOLORY I TERMINAL
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# 256 kolorów + true color
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:RGB"
set -as terminal-overrides ",*:Tc"

# Undercurl support (dla nowoczesnych terminali)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# SKRÓTY KLAWISZOWE - ZARZĄDZANIE SESJAMI I OKNAMI
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Szybkie przeładowanie konfiguracji
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Szybkie tworzenie nowych okien/sesji
bind c new-window -c "#{pane_current_path}"
bind C new-session

# Szybka zamiana na ostatnie okno
bind Tab last-window

# Zabijanie bez potwierdzenia
bind x kill-pane
bind X kill-window
bind Q kill-session

# Wybór drzewa sesji/okien (fuzzy finder style)
bind w choose-tree -Zs
bind W choose-tree -Zw

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# PODZIAŁY OKIEN (SPLITS)
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Intuicyjne dzielenie (zachowuje ścieżkę bieżącą)
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# Równe podziały
bind = select-layout even-horizontal
bind + select-layout even-vertical

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# NAWIGACJA VIM-STYLE
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Przełączanie między panelami (vim-like)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Smart pane switching z wrappowaniem
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Zmiana rozmiaru paneli (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 3
bind -r K resize-pane -U 3
bind -r L resize-pane -R 5

# Nawigacja między oknami (Alt + strzałki lub liczby)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Szybkie przełączanie między oknami
bind -n M-n next-window
bind -n M-p previous-window

# Swap windows
bind -r "<" swap-window -d -t -1
bind -r ">" swap-window -d -t +1

# Przełączanie na pełny ekran
bind f resize-pane -Z

# Wyświetl numery paneli
bind Space display-panes

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# COPY MODE (VI-STYLE)
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Vim-style copy mode
setw -g mode-keys vi

# Wejście w copy mode
bind Escape copy-mode
bind [ copy-mode

# Vim-style selection i kopiowanie
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Y send-keys -X copy-pipe-and-cancel "xclip -in -selection clipboard"

# Wklejanie
bind p paste-buffer
bind P choose-buffer

# Mouse support w copy mode
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel

# Scroll w historii
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# PRZYDATNE FUNKCJE
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Synchronizacja paneli (wysyłaj komendy do wszystkich)
bind S set -w synchronize-panes \; display-message "Sync panes: #{?pane_synchronized,ON,OFF}"

# Clear history i screen
bind C-l send-keys C-l \; clear-history

# Rotate panes
bind C-o rotate-window

# Break pane do nowego okna
bind b break-pane -d

# Join pane z innego okna
bind j command-prompt -p "join pane from:" "join-pane -s '%%'"

# Markowanie paneli
bind m select-pane -m
bind M select-pane -M

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# STATUS BAR - WYGLĄD I INFORMACJE
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

set -g status on
set -g status-interval 2
set -g status-position bottom
set -g status-justify left

# Kolory statusu - minimalistyczny, ciemny
set -g status-style 'bg=#1c1c1c,fg=#808080'

# Lewa strona - kropka indykator + nazwa sesji
set -g status-left-length 50
set -g status-left '#{?client_prefix,#[fg=#00ff00],#[fg=#404040]}● #[fg=#ffffff,bold]#S '

# Prawa strona - minimalistyczna
set -g status-right-length 20
set -g status-right ''

# Wygląd okien w statusie - subtelne kolory
setw -g window-status-style 'fg=#606060,bg=#1c1c1c'
setw -g window-status-format ' #I:#W#F '

setw -g window-status-current-style 'fg=#ffffff,bg=#303030,bold'
setw -g window-status-current-format ' #I:#W#F '

setw -g window-status-activity-style 'fg=#808080,bg=#1c1c1c'
setw -g window-status-bell-style 'fg=#ffffff,bg=#303030'

# Separator między elementami
setw -g window-status-separator ''

# Kolory ramek - subtelne
set -g pane-border-style 'fg=#303030'
set -g pane-active-border-style 'fg=#606060'

# Komunikaty - subtelne
set -g message-style 'bg=#303030,fg=#ffffff,bold'
set -g message-command-style 'bg=#1c1c1c,fg=#808080'

# Copy mode - subtelne
setw -g mode-style 'bg=#303030,fg=#ffffff,bold'

# Clock mode (Ctrl+a t)
setw -g clock-mode-colour '#808080'
setw -g clock-mode-style 24

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# PLUGINS (TPM - Tmux Plugin Manager)
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Lista pluginów
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'          # Sensowne domyślne ustawienia
set -g @plugin 'tmux-plugins/tmux-resurrect'         # Zapisywanie/przywracanie sesji
set -g @plugin 'tmux-plugins/tmux-continuum'         # Automatyczne zapisywanie
set -g @plugin 'tmux-plugins/tmux-yank'              # Lepsze kopiowanie do schowka
set -g @plugin 'tmux-plugins/tmux-open'              # Otwieranie plików i URL-i
set -g @plugin 'tmux-plugins/tmux-copycat'           # Szukanie regex w copy mode
set -g @plugin 'sainnhe/tmux-fzf'                    # FZF integration
set -g @plugin 'fcsonline/tmux-thumbs'               # Szybki wybór tekstu

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# KONFIGURACJA PLUGINÓW
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# tmux-resurrect - zapisywanie stanu
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-save-shell-history 'on'

# tmux-continuum - automatyczne zapisywanie co 15 min
set -g @continuum-restore 'off'  # Wyłączone auto-restore (włącz 'on' jeśli chcesz)
set -g @continuum-save-interval '15'

# tmux-yank - kopiowanie do systemowego schowka
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

# tmux-fzf
TMUX_FZF_LAUNCH_KEY="C-f"
set -g @tmux-fzf-launch 'C-f'

# tmux-thumbs - szybki wybór (hint mode)
set -g @thumbs-key F
set -g @thumbs-command 'echo -n {} | xclip -selection clipboard'

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# INICJALIZACJA TPM (musi być na końcu!)
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Instalacja TPM jeśli nie istnieje (automatycznie przy pierwszym uruchomieniu)
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

run '~/.tmux/plugins/tpm/tpm'

#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# KONIEC KONFIGURACJI
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
