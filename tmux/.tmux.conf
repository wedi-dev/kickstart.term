##### PREFIX & PODSTAWY ########################################################

# Prefix: C-a (jak u Ciebie)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Szybsze reakcje klawiszy i lepsze focus events
set -sg escape-time 0
set -g focus-events on

# Truecolor i właściwy terminfo
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:RGB"

# Historia i scroll
set -g history-limit 100000
set -g mouse on
setw -g mode-keys vi

# Nie zmieniaj nazw okien automatycznie, sensowne indeksy
set -g allow-rename off
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

##### NAWIGACJA & PODZIAŁY ####################################################

# Podziały: | oraz -
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# Vim-style ruch między panelami (prefix + h/j/k/l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Ruch bez prefixu strzałkami Alt (jak u Ciebie)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Szybkie zmiany rozmiaru (przytrzymaj prefix)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 2
bind -r K resize-pane -U 2
bind -r L resize-pane -R 5

# Przydatne: szybkie podświetlenie numerów i wybór drzewa
bind Space display-panes
bind T choose-tree -Zw

# Tryb synchro (broadcast do wszystkich paneli)
bind S set -w synchronize-panes \; display-message "synchronize-panes: #{?pane_synchronized,on,off}"

##### STATUS BAR (DRACULA + METRYKI) ##########################################

set -g status on
set -g status-interval 5
set -g status-position bottom
set -g status-justify centre

# Kolory/temat zostaną spięte przez dracula/tmux, ale bazowe style:
set -g status-bg black
set -g status-fg white

# Lewa strona: host + sesja/okno/panel + info o prefixie (plugin)
set -g status-left-length 60
set -g status-left "#[fg=green]#H #[fg=cyan]#S #[fg=yellow]#I #[fg=cyan]#P #[default]"

# Prawa strona: CPU, bateria, czas (pluginy)
set -g status-right-length 100
set -g status-right "#(uptime | awk -F'load average: ' '{print \"LA:\"$2}')  #{cpu_percentage}  #{battery_percentage}  %Y-%m-%d %H:%M"

# Aktywne okno wyraźnie, spójne obramowania paneli
set -g pane-border-style fg=magenta
set -g pane-active-border-style fg=magenta

##### COPY MODE & CLIPBOARD ####################################################

# tryb kopiowania (vi) i zaznaczenia
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection
bind -T copy-mode-vi r send -X rectangle-toggle

# tmux-yank zadba o OSC52 + xclip/wl-copy/pbcopy w zależności od środowiska
set -g set-clipboard on

##### PLUGINS (TPM) ############################################################

# Manager
set -g @plugin 'tmux-plugins/tpm'

# Sensowne domyślne
set -g @plugin 'tmux-plugins/tmux-sensible'

# Wygląd
set -g @plugin 'dracula/tmux'
# Dracula opcje (odkomentuj/zmień wg preferencji)
set -g @dracula-show-powerline true
set -g @dracula-show-left-icon session
set -g @dracula-plugins "battery cpu"
set -g @dracula-show-flags true
set -g @dracula-fixed-location "Warsaw"
set -g @dracula-show-fahrenheit false

# Użyteczność
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'  # wskaźnik, czy trzymasz prefix
set -g @plugin 'tmux-plugins/tmux-yank'              # kompatybilny schowek (OSC52)
set -g @plugin 'tmux-plugins/tmux-copycat'           # wyszukiwanie w buforze
set -g @plugin 'tmux-plugins/tmux-open'              # otwieranie URL/plików
set -g @plugin 'tmux-plugins/tmux-urlview'           # lista URL-i do kliknięcia
set -g @plugin 'tmux-plugins/tmux-resurrect'         # zapis/restore sesji
set -g @plugin 'tmux-plugins/tmux-continuum'         # autosave co jakiś czas
set -g @plugin 'tmux-plugins/tmux-battery'           # % baterii do status-right
set -g @plugin 'tmux-plugins/tmux-cpu'               # % CPU do status-right

# Konfiguracja resurrect/continuum
set -g @resurrect-strategy-nvim 'session'
set -g @continuum-boot 'on'
set -g @continuum-save-interval '15'

# TPM init (NA SAMYM KOŃCU PLIKU)
run '~/.tmux/plugins/tpm/tpm'